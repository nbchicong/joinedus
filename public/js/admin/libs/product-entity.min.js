/*
 Copyright (c) 2016 CT1905
 Created by Nguyen Ba Chi Cong <nbchicong@gmail.com>
 ---------------------------------------------------
*/
$(function(){function k(a,b){for(var c="",e=a;e<=b;e++)c+=e+"px ";return c.slice(0,-1)}function l(){tinymce.init({selector:"#txt-content",height:400,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code"],toolbar:"undo redo | styleselect fontselect fontsizeselect | bold italic underline forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",
content_css:["../../../css/bootstrap.min.css","../../../css/main.css","../../../css/responsive.css"],fontsize_formats:k(9,36),init_instance_callback:function(a){h=a;j=true}})}var h=null,j=false;UI.ProductEntity=function(){var a=this;this.id="product-entity";this.submitType="JSON";this.$toolbar={BACK:$("#btn-back"),CREATE:$("#btn-add"),SAVE:$("#btn-save")};this.url={list:"product/list",load:"product/load",create:"product/create",update:"product/update",remove:"product/remove"};this.$listItem=$("#list-items");
this.$content=$("#item-content");this.$form={id:$("#txt-id"),name:$("#txt-name"),code:$("#txt-code"),category:$("#cbb-category"),brand:$("#cbb-brand"),price:$("#txt-price"),quantity:$("#txt-quantity"),availability:$("#cbx-availability"),promotions:$("#cbx-promotions"),discount:$("#txt-discount"),tags:$("#txt-tags"),details:$("#txt-content")};this.dataSource=new UI.grid.DataSource({columns:[{type:"selection",align:"center",width:30},{property:"name",label:"T\u00ean s\u1ea3n ph\u1ea9m",sortable:true,
type:"text",align:"left"},{property:"categoryId",label:"Lo\u1ea1i",sortable:true,type:"text",align:"left",width:100},{property:"brandId",label:"Nh\u00e0 s\u1ea3n xu\u1ea5t",sortable:true,type:"text",align:"left",width:150},{property:"price",label:"Gi\u00e1",sortable:true,type:"text",align:"left",width:100},{label:"",type:"action",separate:"&nbsp;",align:"center",buttons:[{text:"S\u1eeda",icon:"fa fa-pencil",labelCls:"label label-info",fn:function(b){a.setEntity(b);a.editRow.call(a,b)}},{text:"X\u00f3a",
icon:"fa fa-trash",labelCls:"label label-important",fn:function(b){if(confirm("B\u1ea1n c\u00f3 \u0111\u1ed3ng \u00fd x\u00f3a?")){a.setEntity(b);a.removeRow.call(a,b)}}}]}],delay:100});this.grid=new UI.Grid({id:this.$listItem.prop("id"),url:this.url.list,dataSource:this.dataSource,idProperty:"id",pageSize:10,remotePaging:true});UI.ProductEntity.superclass.constructor.call(this);l.call(this);this.$toolbar.CREATE.on("click",function(){a.clear();a.next()});this.$toolbar.BACK.on("click",function(){a.clear();
a.prev()});this.$toolbar.SAVE.on("click",function(){a.save(a)})};BaseUI.extend(UI.ProductEntity,UI.Entity,{clear:function(){this.setEntityId(null);this.getForm().find("input,textarea").val("")},setEntity:function(a){this.entity=a},getEntity:function(){return this.entity},setEditorContent:function(a){j?h.setContent(a):this.setEditorContent(a)},setData:function(a){this.setEntity(a);this.$form.name.val(a.name);this.$form.code.val(a.code);this.$form.category.val(a.categoryId);this.$form.brand.val(a.brandId);
this.$form.quantity.val(a.quantity);this.$form.price.val(a.price);this.$form.availability[0].checked=a.availability;this.$form.promotions[0].checked=a.promotions;this.$form.discount.val(a.discount);this.$form.tags.val(a.tags);this.setEditorContent(BaseUI.isEmpty(a.details)?"":a.details)},getData:function(){var a=new FormData;this.setParams(this.getForm().serializeArray());this.getParams().forEach(function(b){a.append(b.name,b.value)});a.append("details",h.getContent());BaseUI.isEmpty(this.getEntityId())||
a.append(this.getIdProperties(),this.getEntityId());return a},getForm:function(){return this.$content.find("form")},create:function(a){var b=this,c=a||BaseUI.emptyFn,e={url:this.url.create,clearForm:false,beforeSerialize:function(){b.$form.details.val(h.getContent())},uploadProgress:function(d,f,g,i){console.log("upload progress",f,g,i)},success:function(d,f,g){c(d,f,g)},error:function(d){console.log("create error",d)},type:"POST"};this.getForm().ajaxSubmit(e)},update:function(a){var b=this,c=a||
BaseUI.emptyFn,e={url:this.url.update,clearForm:false,beforeSerialize:function(){b.$form.details.val(h.getContent())},uploadProgress:function(d,f,g,i){console.log("upload progress",f,g,i)},success:function(d,f,g){c(d,f,g)},error:function(d){console.log("update error",d)},type:"POST"};this.$form.id.val(this.getEntityId());this.getForm().ajaxSubmit(e)},save:function(){var a=this;console.log("save product",this.getForm());BaseUI.isEmpty(this.getEntityId())?this.create(function(b){a.responseHandle(b,
function(){a.grid.reload();a.notify("Create success","success");console.log("%cCreate success","color: #00FF00")})}):this.update(function(b){a.responseHandle(b,function(){a.grid.reload();a.notify("Update success","success");console.log("%cUpdate success","color: #00FF00")})})},load:function(a){var b={id:this.getEntityId()},c=a||BaseUI.emptyFn;this.sendAjax({url:this.url.load,method:"GET",data:this.getSubmitType()=="JSON_STRING"?JSON.stringify(b):b,dataType:"JSON",contentType:"application/json"},c)},
editRow:function(a){var b=this;this.setEntity(a);this.setEntityId(a[this.getIdProperties()]);this.load(function(c){b.responseHandle(c,function(){b.setData(c);b.next()})})},removeRow:function(a){var b=this;this.setEntityId(a[this.getIdProperties()]);this.setParams(this.getEntity());this.remove(function(c){b.responseHandle(c,function(){b.grid.remove(a[b.getIdProperties()])})})},prev:function(){this.$listItem.show();this.$content.hide();this.$toolbar.BACK.hide();this.$toolbar.SAVE.hide()},next:function(){this.$listItem.hide();
this.$content.show();this.$toolbar.BACK.show();this.$toolbar.SAVE.show()}});new UI.ProductEntity});