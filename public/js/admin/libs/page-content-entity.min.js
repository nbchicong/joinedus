/*
 Copyright (c) 2016 CT1905
 Created by Nguyen Ba Chi Cong <nbchicong@gmail.com>
 ---------------------------------------------------
*/
$(function(){function g(a,b){for(var c="",d=a;d<=b;d++)c+=d+"px ";return c.slice(0,-1)}function h(){tinymce.init({selector:"#txt-content",height:400,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks code fullscreen","insertdatetime media table contextmenu paste code"],toolbar:"undo redo | styleselect fontselect fontsizeselect | bold italic underline forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",
content_css:["../../../css/bootstrap.min.css","../../../css/main.css","../../../css/responsive.css"],fontsize_formats:g(9,36),init_instance_callback:function(a){e=a;f=true}})}var e=null,f=false;UI.PageContentEntity=function(){var a=this;this.id="page-content";this.submitType="JSON";this.$toolbar={BACK:$("#btn-back"),CREATE:$("#btn-create"),SAVE:$("#btn-save")};this.url={list:"page/list",load:"page/load",create:"page/create",update:"page/update",remove:"page/remove"};this.$listItem=$("#list-items");
this.$content=$("#item-content");this.$form={id:$("#txt-id"),title:$("#txt-title"),content:$("#txt-content"),tags:$("#txt-tags")};this.dataSource=new UI.grid.DataSource({columns:[{type:"selection",align:"center",width:30},{property:"title",label:"Ti\u00eau \u0111\u1ec1",sortable:true,type:"text",align:"left"},{property:"author",label:"Ng\u01b0\u1eddi vi\u1ebft",sortable:true,type:"text",width:300},{label:"",type:"action",separate:"&nbsp;",align:"center",buttons:[{text:"S\u1eeda",icon:"fa fa-pencil",
labelCls:"label label-info",fn:function(b){a.setEntity(b);a.editRow(b)}},{text:"X\u00f3a",icon:"fa fa-trash",labelCls:"label label-important",fn:function(b){if(confirm("B\u1ea1n c\u00f3 \u0111\u1ed3ng \u00fd x\u00f3a?")){a.setEntity(b);a.removeRow(b)}}}]}],delay:100});this.grid=new UI.Grid({id:this.$listItem.prop("id"),url:this.url.list,dataSource:this.dataSource,idProperty:"id",pageSize:10,remotePaging:true});UI.PageContentEntity.superclass.constructor.call(this);h.call(this);this.$toolbar.CREATE.on("click",
function(){a.clear();a.next()});this.$toolbar.BACK.on("click",function(){a.clear();a.prev()});this.$toolbar.SAVE.on("click",function(){a.save(a)})};BaseUI.extend(UI.PageContentEntity,UI.Entity,{clear:function(){this.setEntityId(null);this.getForm().find("input,textarea").val("")},setEntity:function(a){this.entity=a},getEntity:function(){return this.entity},setEditorContent:function(a){f?e.setContent(a):this.setEditorContent(a)},setData:function(a){this.setEntity(a);this.$form.title.val(a.title);this.$form.tags.val(a.tags);
this.setEditorContent(BaseUI.isEmpty(a.content)?"":a.content)},getData:function(){return{title:this.$form.title.val(),content:e.getContent(),tags:this.$form.tags.val()}},getForm:function(){return this.$content.find('[role="form"]')},save:function(){var a=this,b=this.getData();if(BaseUI.isEmpty(this.getEntityId())){this.setParams(b);this.create(function(c){a.responseHandle(c,function(){a.grid.reload();a.notify("Create success","success");console.log("%cCreate success","color: #00FF00")})})}else{b.id=
this.getEntityId();this.setParams(b);this.update(function(c){a.responseHandle(c,function(){a.grid.reload();a.notify("Update success","success");console.log("%cUpdate success","color: #00FF00")})})}},editRow:function(a){var b=this;this.setEntity(a);this.setEntityId(a[this.getIdProperties()]);b.setData(a);b.next()},removeRow:function(a){var b=this;this.setEntityId(a[this.getIdProperties()]);this.setParams(this.getEntity());this.remove(function(c){b.responseHandle(c,function(){b.grid.remove(a[b.getIdProperties()])})})},
prev:function(){this.$listItem.show();this.$content.hide();this.$toolbar.BACK.hide();this.$toolbar.SAVE.hide()},next:function(){this.$listItem.hide();this.$content.show();this.$toolbar.BACK.show();this.$toolbar.SAVE.show()}});new UI.PageContentEntity});